{"version":3,"file":"spartacus-tracking-tms-gtm.mjs","sources":["../../../feature-libs/tracking/tms/gtm/services/gtm-collector.service.ts","../../../feature-libs/tracking/tms/gtm/config/default-gtm.config.ts","../../../feature-libs/tracking/tms/gtm/gtm.module.ts","../../../feature-libs/tracking/tms/gtm/services/index.ts","../../../feature-libs/tracking/tms/gtm/public_api.ts","../../../feature-libs/tracking/tms/gtm/spartacus-tracking-tms-gtm.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Injectable } from '@angular/core';\nimport { CxEvent, WindowRef } from '@spartacus/core';\nimport {\n  TmsCollector,\n  TmsCollectorConfig,\n  WindowObject,\n} from '@spartacus/tracking/tms/core';\nimport { GtmCollectorConfig } from '../config/default-gtm.config';\n\n/**\n * Default Google Tag Manager collector.\n */\n@Injectable({ providedIn: 'root' })\nexport class GtmCollectorService implements TmsCollector {\n  constructor(protected winRef: WindowRef) {}\n  /**\n   * If the `TmsCollectorConfig.dataLayerProperty` is not specified, it uses the default `dataLayer`\n   */\n  init(config: GtmCollectorConfig, windowObject: WindowObject): void {\n    const dataLayerProperty = config.dataLayerProperty ?? 'dataLayer';\n    windowObject[dataLayerProperty] = windowObject[dataLayerProperty] ?? [];\n\n    if (config.gtmId) {\n      (function (\n        w: WindowObject,\n        d: Document,\n        s: string,\n        l: string,\n        i: string\n      ) {\n        w[l] = w[l] || [];\n        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });\n        const f = d.getElementsByTagName(s)[0];\n        const j = d.createElement(s) as HTMLScriptElement;\n        const dl = l !== 'dataLayer' ? '&l=' + l : '';\n        j.async = true;\n        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;\n        f.parentNode?.insertBefore(j, f);\n      })(\n        windowObject,\n        this.winRef.document,\n        'script',\n        dataLayerProperty,\n        config.gtmId\n      );\n    }\n  }\n\n  pushEvent<T extends CxEvent>(\n    config: TmsCollectorConfig,\n    windowObject: WindowObject,\n    event: T | any\n  ): void {\n    const dataLayerProperty = config.dataLayerProperty ?? 'dataLayer';\n    windowObject[dataLayerProperty].push(event);\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { TmsCollectorConfig, TmsConfig } from '@spartacus/tracking/tms/core';\nimport { GtmCollectorService } from '../services/gtm-collector.service';\n\nexport interface GtmCollectorConfig extends TmsCollectorConfig {\n  gtmId?: string;\n}\n\ndeclare module '@spartacus/tracking/tms/core' {\n  interface TmsCollectors {\n    gtm?: GtmCollectorConfig;\n  }\n}\n\nexport const defaultGoogleTagManagerConfig: TmsConfig = {\n  tagManager: {\n    gtm: {\n      collector: GtmCollectorService,\n    },\n  },\n};\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { NgModule } from '@angular/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { defaultGoogleTagManagerConfig } from './config/default-gtm.config';\n\n@NgModule({\n  providers: [provideDefaultConfig(defaultGoogleTagManagerConfig)],\n})\nexport class GtmModule {}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './gtm-collector.service';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './gtm.module';\nexport * from './services/index';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}