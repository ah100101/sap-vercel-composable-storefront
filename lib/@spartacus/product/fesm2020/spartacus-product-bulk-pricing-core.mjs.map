{"version":3,"file":"spartacus-product-bulk-pricing-core.mjs","sources":["../../../feature-libs/product/bulk-pricing/core/model/bulk-price.model.ts","../../../feature-libs/product/bulk-pricing/core/model/augmented-core.model.ts","../../../feature-libs/product/bulk-pricing/core/model/index.ts","../../../feature-libs/product/bulk-pricing/core/services/bulk-pricing.service.ts","../../../feature-libs/product/bulk-pricing/core/services/index.ts","../../../feature-libs/product/bulk-pricing/core/public_api.ts","../../../feature-libs/product/bulk-pricing/core/spartacus-product-bulk-pricing-core.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface BulkPrice {\n  currencyIso?: string;\n  formattedValue?: string;\n  maxQuantity?: number;\n  minQuantity?: number;\n  priceType?: string;\n  value?: number;\n  formattedDiscount?: string;\n  discount?: number;\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport '@spartacus/core';\n\ndeclare module '@spartacus/core' {\n  const enum ProductScope {\n    BULK_PRICES = 'bulkPrices',\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './bulk-price.model';\n// Imported for side effects (module augmentation)\nimport './augmented-core.model';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Injectable } from '@angular/core';\nimport { Price, Product, ProductScope, ProductService } from '@spartacus/core';\nimport { Observable, of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { BulkPrice } from '../model/bulk-price.model';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class BulkPricingService {\n  protected readonly PRODUCT_SCOPE = ProductScope.BULK_PRICES;\n\n  constructor(protected productService: ProductService) {}\n\n  getBulkPrices(productCode: string): Observable<BulkPrice[] | undefined> {\n    return this.productService.get(productCode, this.PRODUCT_SCOPE).pipe(\n      switchMap((productPriceScope) => {\n        return of(this.convert(productPriceScope));\n      })\n    );\n  }\n\n  protected convert(\n    productPriceScope: Product | undefined\n  ): BulkPrice[] | undefined {\n    let bulkPrices: BulkPrice[] | undefined = [];\n\n    if (productPriceScope) {\n      const basePrice: number | undefined = productPriceScope.price?.value;\n      const volumePrices: Price[] | undefined = productPriceScope.volumePrices;\n\n      bulkPrices = volumePrices?.map((volumePrice) =>\n        this.parsePrice(volumePrice, basePrice)\n      );\n    }\n\n    return bulkPrices;\n  }\n\n  protected parsePrice(\n    priceTier: Price,\n    basePrice: number | undefined\n  ): BulkPrice {\n    const bulkPriceTemplate: BulkPrice = {\n      currencyIso: priceTier.currencyIso,\n      formattedValue: priceTier.formattedValue,\n      maxQuantity: priceTier.maxQuantity,\n      minQuantity: priceTier.minQuantity,\n      priceType: priceTier.priceType,\n      value: priceTier.value,\n      formattedDiscount: '',\n      discount: 0,\n    };\n\n    return this.calculateDiscount(bulkPriceTemplate, basePrice);\n  }\n\n  protected calculateDiscount(\n    bulkPriceTemplate: BulkPrice,\n    basePrice: number | undefined\n  ): BulkPrice {\n    const bulkPrice = Object.assign({}, bulkPriceTemplate);\n\n    const tierPrice: number | undefined = bulkPriceTemplate.value;\n\n    if (tierPrice && basePrice) {\n      const discount = Math.round(100.0 - (tierPrice / basePrice) * 100);\n      const formatted = discount === 0 ? `${discount}%` : `-${discount}%`;\n      bulkPrice.formattedDiscount = formatted;\n      bulkPrice.discount = discount;\n    }\n\n    return bulkPrice;\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './bulk-pricing.service';\n","/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './model/index';\nexport * from './services/index';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}