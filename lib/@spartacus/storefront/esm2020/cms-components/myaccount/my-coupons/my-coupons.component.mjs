/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Component } from '@angular/core';
import { combineLatest, Subscription } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { ICON_TYPE } from '../../misc/icon/icon.model';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
import * as i2 from "./my-coupons.component.service";
import * as i3 from "@angular/common";
import * as i4 from "../../../shared/components/spinner/spinner.component";
import * as i5 from "@angular/router";
import * as i6 from "../../misc/icon/icon.component";
import * as i7 from "../../../shared/components/list-navigation/sorting/sorting.component";
import * as i8 from "../../../shared/components/list-navigation/pagination/pagination.component";
import * as i9 from "./coupon-card/coupon-card.component";
export class MyCouponsComponent {
    constructor(couponService, myCouponsComponentService) {
        this.couponService = couponService;
        this.myCouponsComponentService = myCouponsComponentService;
        this.iconTypes = ICON_TYPE;
        this.subscriptions = new Subscription();
        this.PAGE_SIZE = 10;
        this.sortMapping = {
            byStartDateAsc: 'startDate:asc',
            byStartDateDesc: 'startDate:desc',
            byEndDateAsc: 'endDate:asc',
            byEndDateDesc: 'endDate:desc',
        };
        this.sort = 'byStartDateAsc';
        this.sortOptions = [
            {
                code: 'byStartDateAsc',
                selected: false,
            },
            {
                code: 'byStartDateDesc',
                selected: false,
            },
            {
                code: 'byEndDateAsc',
                selected: false,
            },
            {
                code: 'byEndDateDesc',
                selected: false,
            },
        ];
    }
    ngOnInit() {
        this.couponResult$ = this.couponService
            .getCustomerCoupons(this.PAGE_SIZE)
            .pipe(tap((coupons) => (this.pagination = {
            currentPage: coupons.pagination?.page,
            pageSize: coupons.pagination?.count,
            totalPages: coupons.pagination?.totalPages,
            totalResults: coupons.pagination?.totalCount,
            sort: this.sort,
        })));
        this.couponsLoading$ = this.couponService.getCustomerCouponsLoading();
        this.couponSubscriptionLoading$ = combineLatest([
            this.couponService.getSubscribeCustomerCouponResultLoading(),
            this.couponService.getUnsubscribeCustomerCouponResultLoading(),
        ]).pipe(map(([subscribing, unsubscribing]) => subscribing || unsubscribing));
        this.sortLabels = this.myCouponsComponentService.getSortLabels();
        this.subscriptions
            .add(this.couponService
            .getSubscribeCustomerCouponResultError()
            .subscribe((error) => {
            this.subscriptionFail(error);
        }))
            .add(this.couponService
            .getUnsubscribeCustomerCouponResultError()
            .subscribe((error) => {
            this.subscriptionFail(error);
        }));
    }
    subscriptionFail(error) {
        if (error) {
            this.couponService.loadCustomerCoupons(this.PAGE_SIZE);
        }
    }
    sortChange(sort) {
        this.sort = sort;
        this.couponService.loadCustomerCoupons(this.PAGE_SIZE, this.pagination.currentPage, this.sortMapping[sort]);
    }
    pageChange(page) {
        this.couponService.loadCustomerCoupons(this.PAGE_SIZE, page, this.sortMapping[this.sort]);
    }
    notificationChange({ couponId, notification, }) {
        if (notification) {
            this.couponService.subscribeCustomerCoupon(couponId);
        }
        else {
            this.couponService.unsubscribeCustomerCoupon(couponId);
        }
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
}
MyCouponsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: MyCouponsComponent, deps: [{ token: i1.CustomerCouponService }, { token: i2.MyCouponsComponentService }], target: i0.ɵɵFactoryTarget.Component });
MyCouponsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.4", type: MyCouponsComponent, selector: "cx-my-coupons", ngImport: i0, template: "<div class=\"cx-section\">\n  <ng-container *ngIf=\"!(couponsLoading$ | async); else loading\">\n    <div role=\"status\" [attr.aria-label]=\"'common.loaded' | cxTranslate\"></div>\n    <ng-container *ngIf=\"couponResult$ | async as couponResult\">\n      <div class=\"cx-my-coupons-header\">\n        <h2>\n          {{ 'myCoupons.myCoupons' | cxTranslate }}\n        </h2>\n      </div>\n      <ng-container\n        *ngIf=\"\n          couponResult.pagination &&\n            couponResult.pagination.totalCount &&\n            couponResult.pagination.totalCount > 0;\n          else noCoupons\n        \"\n      >\n        <div class=\"cx-my-coupons-sort top row\">\n          <label\n            class=\"\n              cx-my-coupons-form-group\n              form-group\n              col-sm-12 col-md-4 col-lg-4\n            \"\n          >\n            <span>{{ 'myCoupons.sortBy' | cxTranslate }}</span>\n            <cx-sorting\n              [sortOptions]=\"sortOptions\"\n              [sortLabels]=\"sortLabels | async\"\n              (sortListEvent)=\"sortChange($event)\"\n              [selectedOption]=\"sort\"\n              [ariaLabel]=\"'myCoupons.sortCoupons' | cxTranslate\"\n              ariaControls=\"coupon-deck\"\n            >\n            </cx-sorting>\n          </label>\n          <div class=\"cx-my-coupons-pagination cx-mycoupon-thead-mobile\">\n            <cx-pagination\n              [pagination]=\"pagination\"\n              (viewPageEvent)=\"pageChange($event)\"\n            ></cx-pagination>\n          </div>\n        </div>\n\n        <div id=\"coupon-deck\" class=\"row cx-coupon-deck\">\n          <div\n            *ngFor=\"let coupon of couponResult.coupons\"\n            class=\"col-md-6 cx-coupon-card\"\n          >\n            <cx-coupon-card\n              [coupon]=\"coupon\"\n              [couponSubscriptionLoading$]=\"couponSubscriptionLoading$\"\n              (notificationChanged)=\"notificationChange($event)\"\n            ></cx-coupon-card>\n          </div>\n        </div>\n\n        <div class=\"cx-my-coupons-sort bottom row\">\n          <label\n            class=\"\n              cx-my-coupons-form-group\n              form-group\n              cx-mycoupon-thead-mobile\n              col-sm-12 col-md-4 col-lg-4\n            \"\n          >\n            <span>{{ 'myCoupons.sortBy' | cxTranslate }}</span>\n            <cx-sorting\n              [sortOptions]=\"sortOptions\"\n              [sortLabels]=\"sortLabels | async\"\n              (sortListEvent)=\"sortChange($event)\"\n              [selectedOption]=\"sort\"\n              placeholder=\"{{ 'myCoupons.sortBy' | cxTranslate }}\"\n              [ariaLabel]=\"'myCoupons.sortCoupons' | cxTranslate\"\n              ariaControls=\"coupon-deck\"\n            >\n            </cx-sorting>\n          </label>\n          <div class=\"cx-my-coupons-pagination\">\n            <cx-pagination\n              [pagination]=\"pagination\"\n              (viewPageEvent)=\"pageChange($event)\"\n            ></cx-pagination>\n          </div>\n        </div>\n        <div class=\"cx-my-coupons-notes\">\n          <span>\n            <cx-icon [type]=\"iconTypes.INFO\"></cx-icon>\n            {{ 'myCoupons.notesPreffix' | cxTranslate\n            }}<a [routerLink]=\"['/my-account/notification-preference']\">{{\n              'myCoupons.notesLink' | cxTranslate\n            }}</a\n            >{{ 'myCoupons.notesSuffix' | cxTranslate }}</span\n          >\n        </div>\n      </ng-container>\n    </ng-container>\n\n    <ng-template #noCoupons>\n      <section>\n        <p class=\"cx-section-msg\">\n          {{ 'myCoupons.noCouponsMessage' | cxTranslate }}\n        </p>\n      </section>\n    </ng-template>\n  </ng-container>\n\n  <ng-template #loading>\n    <div class=\"col-md-12 cx-coupon-spinner\">\n      <cx-spinner></cx-spinner>\n    </div>\n  </ng-template>\n</div>\n", dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.SpinnerComponent, selector: "cx-spinner" }, { kind: "directive", type: i5.RouterLink, selector: "[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "component", type: i6.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "component", type: i7.SortingComponent, selector: "cx-sorting", inputs: ["sortOptions", "ariaControls", "ariaLabel", "selectedOption", "placeholder", "sortLabels"], outputs: ["sortListEvent"] }, { kind: "component", type: i8.PaginationComponent, selector: "cx-pagination", inputs: ["pageRoute", "queryParam", "defaultPage", "pagination"], outputs: ["viewPageEvent"] }, { kind: "component", type: i9.CouponCardComponent, selector: "cx-coupon-card", inputs: ["coupon", "couponSubscriptionLoading$"], outputs: ["notificationChanged"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i1.TranslatePipe, name: "cxTranslate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: MyCouponsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-my-coupons', template: "<div class=\"cx-section\">\n  <ng-container *ngIf=\"!(couponsLoading$ | async); else loading\">\n    <div role=\"status\" [attr.aria-label]=\"'common.loaded' | cxTranslate\"></div>\n    <ng-container *ngIf=\"couponResult$ | async as couponResult\">\n      <div class=\"cx-my-coupons-header\">\n        <h2>\n          {{ 'myCoupons.myCoupons' | cxTranslate }}\n        </h2>\n      </div>\n      <ng-container\n        *ngIf=\"\n          couponResult.pagination &&\n            couponResult.pagination.totalCount &&\n            couponResult.pagination.totalCount > 0;\n          else noCoupons\n        \"\n      >\n        <div class=\"cx-my-coupons-sort top row\">\n          <label\n            class=\"\n              cx-my-coupons-form-group\n              form-group\n              col-sm-12 col-md-4 col-lg-4\n            \"\n          >\n            <span>{{ 'myCoupons.sortBy' | cxTranslate }}</span>\n            <cx-sorting\n              [sortOptions]=\"sortOptions\"\n              [sortLabels]=\"sortLabels | async\"\n              (sortListEvent)=\"sortChange($event)\"\n              [selectedOption]=\"sort\"\n              [ariaLabel]=\"'myCoupons.sortCoupons' | cxTranslate\"\n              ariaControls=\"coupon-deck\"\n            >\n            </cx-sorting>\n          </label>\n          <div class=\"cx-my-coupons-pagination cx-mycoupon-thead-mobile\">\n            <cx-pagination\n              [pagination]=\"pagination\"\n              (viewPageEvent)=\"pageChange($event)\"\n            ></cx-pagination>\n          </div>\n        </div>\n\n        <div id=\"coupon-deck\" class=\"row cx-coupon-deck\">\n          <div\n            *ngFor=\"let coupon of couponResult.coupons\"\n            class=\"col-md-6 cx-coupon-card\"\n          >\n            <cx-coupon-card\n              [coupon]=\"coupon\"\n              [couponSubscriptionLoading$]=\"couponSubscriptionLoading$\"\n              (notificationChanged)=\"notificationChange($event)\"\n            ></cx-coupon-card>\n          </div>\n        </div>\n\n        <div class=\"cx-my-coupons-sort bottom row\">\n          <label\n            class=\"\n              cx-my-coupons-form-group\n              form-group\n              cx-mycoupon-thead-mobile\n              col-sm-12 col-md-4 col-lg-4\n            \"\n          >\n            <span>{{ 'myCoupons.sortBy' | cxTranslate }}</span>\n            <cx-sorting\n              [sortOptions]=\"sortOptions\"\n              [sortLabels]=\"sortLabels | async\"\n              (sortListEvent)=\"sortChange($event)\"\n              [selectedOption]=\"sort\"\n              placeholder=\"{{ 'myCoupons.sortBy' | cxTranslate }}\"\n              [ariaLabel]=\"'myCoupons.sortCoupons' | cxTranslate\"\n              ariaControls=\"coupon-deck\"\n            >\n            </cx-sorting>\n          </label>\n          <div class=\"cx-my-coupons-pagination\">\n            <cx-pagination\n              [pagination]=\"pagination\"\n              (viewPageEvent)=\"pageChange($event)\"\n            ></cx-pagination>\n          </div>\n        </div>\n        <div class=\"cx-my-coupons-notes\">\n          <span>\n            <cx-icon [type]=\"iconTypes.INFO\"></cx-icon>\n            {{ 'myCoupons.notesPreffix' | cxTranslate\n            }}<a [routerLink]=\"['/my-account/notification-preference']\">{{\n              'myCoupons.notesLink' | cxTranslate\n            }}</a\n            >{{ 'myCoupons.notesSuffix' | cxTranslate }}</span\n          >\n        </div>\n      </ng-container>\n    </ng-container>\n\n    <ng-template #noCoupons>\n      <section>\n        <p class=\"cx-section-msg\">\n          {{ 'myCoupons.noCouponsMessage' | cxTranslate }}\n        </p>\n      </section>\n    </ng-template>\n  </ng-container>\n\n  <ng-template #loading>\n    <div class=\"col-md-12 cx-coupon-spinner\">\n      <cx-spinner></cx-spinner>\n    </div>\n  </ng-template>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.CustomerCouponService }, { type: i2.MyCouponsComponentService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktY291cG9ucy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zdG9yZWZyb250bGliL2Ntcy1jb21wb25lbnRzL215YWNjb3VudC9teS1jb3Vwb25zL215LWNvdXBvbnMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc3RvcmVmcm9udGxpYi9jbXMtY29tcG9uZW50cy9teWFjY291bnQvbXktY291cG9ucy9teS1jb3Vwb25zLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsU0FBUyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQU03RCxPQUFPLEVBQUUsYUFBYSxFQUFjLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvRCxPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQzs7Ozs7Ozs7Ozs7QUFPdkQsTUFBTSxPQUFPLGtCQUFrQjtJQTZDN0IsWUFDWSxhQUFvQyxFQUNwQyx5QkFBb0Q7UUFEcEQsa0JBQWEsR0FBYixhQUFhLENBQXVCO1FBQ3BDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUExQ2hFLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFFZCxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFbkMsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLGdCQUFXLEdBQThCO1lBQy9DLGNBQWMsRUFBRSxlQUFlO1lBQy9CLGVBQWUsRUFBRSxnQkFBZ0I7WUFDakMsWUFBWSxFQUFFLGFBQWE7WUFDM0IsYUFBYSxFQUFFLGNBQWM7U0FDOUIsQ0FBQztRQUNGLFNBQUksR0FBRyxnQkFBZ0IsQ0FBQztRQUV4QixnQkFBVyxHQUFHO1lBQ1o7Z0JBQ0UsSUFBSSxFQUFFLGdC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QUksWUFBWSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDdEQ7YUFBTTtZQUNMLElBQUksQ0FBQyxhQUFhLENBQUMseUJBQXlCLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDeEQ7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbkMsQ0FBQzs7K0dBbklVLGtCQUFrQjttR0FBbEIsa0JBQWtCLHFEQ3JCL0IsNjBIQWlIQTsyRkQ1RmEsa0JBQWtCO2tCQUo5QixTQUFTOytCQUNFLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMyBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uRGVzdHJveSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBDdXN0b21lckNvdXBvblNlYXJjaFJlc3VsdCxcbiAgQ3VzdG9tZXJDb3Vwb25TZXJ2aWNlLFxuICBQYWdpbmF0aW9uTW9kZWwsXG59IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSUNPTl9UWVBFIH0gZnJvbSAnLi4vLi4vbWlzYy9pY29uL2ljb24ubW9kZWwnO1xuaW1wb3J0IHsgTXlDb3Vwb25zQ29tcG9uZW50U2VydmljZSB9IGZyb20gJy4vbXktY291cG9ucy5jb21wb25lbnQuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LW15LWNvdXBvbnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vbXktY291cG9ucy5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIE15Q291cG9uc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgY291cG9uUmVzdWx0JDogT2JzZXJ2YWJsZTxDdXN0b21lckNvdXBvblNlYXJjaFJlc3VsdD47XG4gIGNvdXBvbnNMb2FkaW5nJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgY291cG9uU3Vic2NyaXB0aW9uTG9hZGluZyQ6IE9ic2VydmFibGU8Ym9vbGVhbj47XG5cbiAgaWNvblR5cGVzID0gSUNPTl9UWVBFO1xuXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9ucyA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBwcml2YXRlIFBBR0VfU0laRSA9IDEwO1xuICBwcml2YXRlIHNvcnRNYXBwaW5nOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAgIGJ5U3RhcnREYXRlQXNjOiAnc3RhcnREYXRlOmFzYycsXG4gICAgYnlTdGFydERhdGVEZXNjOiAnc3RhcnREYXRlOmRlc2MnLFxuICAgIGJ5RW5kRGF0ZUFzYzogJ2VuZERhdGU6YXNjJyxcbiAgICBieUVuZERhdGVEZXNjOiAnZW5kRGF0ZTpkZXNjJyxcbiAgfTtcbiAgc29ydCA9ICdieVN0YXJ0RGF0ZUFzYyc7XG5cbiAgc29ydE9wdGlvbnMgPSBbXG4gICAge1xuICAgICAgY29kZTogJ2J5U3RhcnREYXRlQXNjJyxcbiAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGNvZGU6ICdieVN0YXJ0RGF0ZURlc2MnLFxuICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgIH0sXG4gICAge1xuICAgICAgY29kZTogJ2J5RW5kRGF0ZUFzYycsXG4gICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBjb2RlOiAnYnlFbmREYXRlRGVzYycsXG4gICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgfSxcbiAgXTtcblxuICBwYWdpbmF0aW9uOiBQYWdpbmF0aW9uTW9kZWw7XG4gIHNvcnRMYWJlbHM6IE9ic2VydmFibGU8e1xuICAgIGJ5U3RhcnREYXRlQXNjOiBzdHJpbmc7XG4gICAgYnlTdGFydERhdGVEZXNjOiBzdHJpbmc7XG4gICAgYnlFbmREYXRlQXNjOiBzdHJpbmc7XG4gICAgYnlFbmREYXRlRGVzYzogc3RyaW5nO1xuICB9PjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY291cG9uU2VydmljZTogQ3VzdG9tZXJDb3Vwb25TZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBteUNvdXBvbnNDb21wb25lbnRTZXJ2aWNlOiBNeUNvdXBvbnNDb21wb25lbnRTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmNvdXBvblJlc3VsdCQgPSB0aGlzLmNvdXBvblNlcnZpY2VcbiAgICAgIC5nZXRDdXN0b21lckNvdXBvbnModGhpcy5QQUdFX1NJWkUpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKFxuICAgICAgICAgIChjb3Vwb25zKSA9PlxuICAgICAgICAgICAgKHRoaXMucGFnaW5hdGlvbiA9IHtcbiAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IGNvdXBvbnMucGFnaW5hdGlvbj8ucGFnZSxcbiAgICAgICAgICAgICAgcGFnZVNpemU6IGNvdXBvbnMucGFnaW5hdGlvbj8uY291bnQsXG4gICAgICAgICAgICAgIHRvdGFsUGFnZXM6IGNvdXBvbnMucGFnaW5hdGlvbj8udG90YWxQYWdlcyxcbiAgICAgICAgICAgICAgdG90YWxSZXN1bHRzOiBjb3Vwb25zLnBhZ2luYXRpb24/LnRvdGFsQ291bnQsXG4gICAgICAgICAgICAgIHNvcnQ6IHRoaXMuc29ydCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgdGhpcy5jb3Vwb25zTG9hZGluZyQgPSB0aGlzLmNvdXBvblNlcnZpY2UuZ2V0Q3VzdG9tZXJDb3Vwb25zTG9hZGluZygpO1xuICAgIHRoaXMuY291cG9uU3Vic2NyaXB0aW9uTG9hZGluZyQgPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMuY291cG9uU2VydmljZS5nZXRTdWJzY3JpYmVDdXN0b21lckNvdXBvblJlc3VsdExvYWRpbmcoKSxcbiAgICAgIHRoaXMuY291cG9uU2VydmljZS5nZXRVbnN1YnNjcmliZUN1c3RvbWVyQ291cG9uUmVzdWx0TG9hZGluZygpLFxuICAgIF0pLnBpcGUoXG4gICAgICBtYXAoKFtzdWJzY3JpYmluZywgdW5zdWJzY3JpYmluZ10pID0+IHN1YnNjcmliaW5nIHx8IHVuc3Vic2NyaWJpbmcpXG4gICAgKTtcbiAgICB0aGlzLnNvcnRMYWJlbHMgPSB0aGlzLm15Q291cG9uc0NvbXBvbmVudFNlcnZpY2UuZ2V0U29ydExhYmVscygpO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zXG4gICAgICAuYWRkKFxuICAgICAgICB0aGlzLmNvdXBvblNlcnZpY2VcbiAgICAgICAgICAuZ2V0U3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb25SZXN1bHRFcnJvcigpXG4gICAgICAgICAgLnN1YnNjcmliZSgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uRmFpbChlcnJvcik7XG4gICAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5hZGQoXG4gICAgICAgIHRoaXMuY291cG9uU2VydmljZVxuICAgICAgICAgIC5nZXRVbnN1YnNjcmliZUN1c3RvbWVyQ291cG9uUmVzdWx0RXJyb3IoKVxuICAgICAgICAgIC5zdWJzY3JpYmUoKGVycm9yKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbkZhaWwoZXJyb3IpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25GYWlsKGVycm9yOiBib29sZWFuKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICB0aGlzLmNvdXBvblNlcnZpY2UubG9hZEN1c3RvbWVyQ291cG9ucyh0aGlzLlBBR0VfU0laRSk7XG4gICAgfVxuICB9XG5cbiAgc29ydENoYW5nZShzb3J0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnNvcnQgPSBzb3J0O1xuXG4gICAgdGhpcy5jb3Vwb25TZXJ2aWNlLmxvYWRDdXN0b21lckNvdXBvbnMoXG4gICAgICB0aGlzLlBBR0VfU0laRSxcbiAgICAgIHRoaXMucGFnaW5hdGlvbi5jdXJyZW50UGFnZSxcbiAgICAgIHRoaXMuc29ydE1hcHBpbmdbc29ydF1cbiAgICApO1xuICB9XG5cbiAgcGFnZUNoYW5nZShwYWdlOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmNvdXBvblNlcnZpY2UubG9hZEN1c3RvbWVyQ291cG9ucyhcbiAgICAgIHRoaXMuUEFHRV9TSVpFLFxuICAgICAgcGFnZSxcbiAgICAgIHRoaXMuc29ydE1hcHBpbmdbdGhpcy5zb3J0XVxuICAgICk7XG4gIH1cblxuICBub3RpZmljYXRpb25DaGFuZ2Uoe1xuICAgIGNvdXBvbklkLFxuICAgIG5vdGlmaWNhdGlvbixcbiAgfToge1xuICAgIGNvdXBvbklkOiBzdHJpbmc7XG4gICAgbm90aWZpY2F0aW9uOiBib29sZWFuO1xuICB9KTogdm9pZCB7XG4gICAgaWYgKG5vdGlmaWNhdGlvbikge1xuICAgICAgdGhpcy5jb3Vwb25TZXJ2aWNlLnN1YnNjcmliZUN1c3RvbWVyQ291cG9uKGNvdXBvbklkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb3Vwb25TZXJ2aWNlLnVuc3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb24oY291cG9uSWQpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY3gtc2VjdGlvblwiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiIShjb3Vwb25zTG9hZGluZyQgfCBhc3luYyk7IGVsc2UgbG9hZGluZ1wiPlxuICAgIDxkaXYgcm9sZT1cInN0YXR1c1wiIFthdHRyLmFyaWEtbGFiZWxdPVwiJ2NvbW1vbi5sb2FkZWQnIHwgY3hUcmFuc2xhdGVcIj48L2Rpdj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY291cG9uUmVzdWx0JCB8IGFzeW5jIGFzIGNvdXBvblJlc3VsdFwiPlxuICAgICAgPGRpdiBjbGFzcz1cImN4LW15LWNvdXBvbnMtaGVhZGVyXCI+XG4gICAgICAgIDxoMj5cbiAgICAgICAgICB7eyAnbXlDb3Vwb25zLm15Q291cG9ucycgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICA8L2gyPlxuICAgICAgPC9kaXY+XG4gICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICpuZ0lmPVwiXG4gICAgICAgICAgY291cG9uUmVzdWx0LnBhZ2luYXRpb24gJiZcbiAgICAgICAgICAgIGNvdXBvblJlc3VsdC5wYWdpbmF0aW9uLnRvdGFsQ291bnQgJiZcbiAgICAgICAgICAgIGNvdXBvblJlc3VsdC5wYWdpbmF0aW9uLnRvdGFsQ291bnQgPiAwO1xuICAgICAgICAgIGVsc2Ugbm9Db3Vwb25zXG4gICAgICAgIFwiXG4gICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1teS1jb3Vwb25zLXNvcnQgdG9wIHJvd1wiPlxuICAgICAgICAgIDxsYWJlbFxuICAgICAgICAgICAgY2xhc3M9XCJcbiAgICAgICAgICAgICAgY3gtbXktY291cG9ucy1mb3JtLWdyb3VwXG4gICAgICAgICAgICAgIGZvcm0tZ3JvdXBcbiAgICAgICAgICAgICAgY29sLXNtLTEyIGNvbC1tZC00IGNvbC1sZy00XG4gICAgICAgICAgICBcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxzcGFuPnt7ICdteUNvdXBvbnMuc29ydEJ5JyB8IGN4VHJhbnNsYXRlIH19PC9zcGFuPlxuICAgICAgICAgICAgPGN4LXNvcnRpbmdcbiAgICAgICAgICAgICAgW3NvcnRPcHRpb25zXT1cInNvcnRPcHRpb25zXCJcbiAgICAgICAgICAgICAgW3NvcnRMYWJlbHNdPVwic29ydExhYmVscyB8IGFzeW5jXCJcbiAgICAgICAgICAgICAgKHNvcnRMaXN0RXZlbnQpPVwic29ydENoYW5nZSgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgW3NlbGVjdGVkT3B0aW9uXT1cInNvcnRcIlxuICAgICAgICAgICAgICBbYXJpYUxhYmVsXT1cIidteUNvdXBvbnMuc29ydENvdXBvbnMnIHwgY3hUcmFuc2xhdGVcIlxuICAgICAgICAgICAgICBhcmlhQ29udHJvbHM9XCJjb3Vwb24tZGVja1wiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICA8L2N4LXNvcnRpbmc+XG4gICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3gtbXktY291cG9ucy1wYWdpbmF0aW9uIGN4LW15Y291cG9uLXRoZWFkLW1vYmlsZVwiPlxuICAgICAgICAgICAgPGN4LXBhZ2luYXRpb25cbiAgICAgICAgICAgICAgW3BhZ2luYXRpb25dPVwicGFnaW5hdGlvblwiXG4gICAgICAgICAgICAgICh2aWV3UGFnZUV2ZW50KT1cInBhZ2VDaGFuZ2UoJGV2ZW50KVwiXG4gICAgICAgICAgICA+PC9jeC1wYWdpbmF0aW9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGlkPVwiY291cG9uLWRlY2tcIiBjbGFzcz1cInJvdyBjeC1jb3Vwb24tZGVja1wiPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICpuZ0Zvcj1cImxldCBjb3Vwb24gb2YgY291cG9uUmVzdWx0LmNvdXBvbnNcIlxuICAgICAgICAgICAgY2xhc3M9XCJjb2wtbWQtNiBjeC1jb3Vwb24tY2FyZFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGN4LWNvdXBvbi1jYXJkXG4gICAgICAgICAgICAgIFtjb3Vwb25dPVwiY291cG9uXCJcbiAgICAgICAgICAgICAgW2NvdXBvblN1YnNjcmlwdGlvbkxvYWRpbmckXT1cImNvdXBvblN1YnNjcmlwdGlvbkxvYWRpbmckXCJcbiAgICAgICAgICAgICAgKG5vdGlmaWNhdGlvbkNoYW5nZWQpPVwibm90aWZpY2F0aW9uQ2hhbmdlKCRldmVudClcIlxuICAgICAgICAgICAgPjwvY3gtY291cG9uLWNhcmQ+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1teS1jb3Vwb25zLXNvcnQgYm90dG9tIHJvd1wiPlxuICAgICAgICAgIDxsYWJlbFxuICAgICAgICAgICAgY2xhc3M9XCJcbiAgICAgICAgICAgICAgY3gtbXktY291cG9ucy1mb3JtLWdyb3VwXG4gICAgICAgICAgICAgIGZvcm0tZ3JvdXBcbiAgICAgICAgICAgICAgY3gtbXljb3Vwb24tdGhlYWQtbW9iaWxlXG4gICAgICAgICAgICAgIGNvbC1zbS0xMiBjb2wtbWQtNCBjb2wtbGctNFxuICAgICAgICAgICAgXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8c3Bhbj57eyAnbXlDb3Vwb25zLnNvcnRCeScgfCBjeFRyYW5zbGF0ZSB9fTwvc3Bhbj5cbiAgICAgICAgICAgIDxjeC1zb3J0aW5nXG4gICAgICAgICAgICAgIFtzb3J0T3B0aW9uc109XCJzb3J0T3B0aW9uc1wiXG4gICAgICAgICAgICAgIFtzb3J0TGFiZWxzXT1cInNvcnRMYWJlbHMgfCBhc3luY1wiXG4gICAgICAgICAgICAgIChzb3J0TGlzdEV2ZW50KT1cInNvcnRDaGFuZ2UoJGV2ZW50KVwiXG4gICAgICAgICAgICAgIFtzZWxlY3RlZE9wdGlvbl09XCJzb3J0XCJcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ7eyAnbXlDb3Vwb25zLnNvcnRCeScgfCBjeFRyYW5zbGF0ZSB9fVwiXG4gICAgICAgICAgICAgIFthcmlhTGFiZWxdPVwiJ215Q291cG9ucy5zb3J0Q291cG9ucycgfCBjeFRyYW5zbGF0ZVwiXG4gICAgICAgICAgICAgIGFyaWFDb250cm9scz1cImNvdXBvbi1kZWNrXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDwvY3gtc29ydGluZz5cbiAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1teS1jb3Vwb25zLXBhZ2luYXRpb25cIj5cbiAgICAgICAgICAgIDxjeC1wYWdpbmF0aW9uXG4gICAgICAgICAgICAgIFtwYWdpbmF0aW9uXT1cInBhZ2luYXRpb25cIlxuICAgICAgICAgICAgICAodmlld1BhZ2VFdmVudCk9XCJwYWdlQ2hhbmdlKCRldmVudClcIlxuICAgICAgICAgICAgPjwvY3gtcGFnaW5hdGlvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1teS1jb3Vwb25zLW5vdGVzXCI+XG4gICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICA8Y3gtaWNvbiBbdHlwZV09XCJpY29uVHlwZXMuSU5GT1wiPjwvY3gtaWNvbj5cbiAgICAgICAgICAgIHt7ICdteUNvdXBvbnMubm90ZXNQcmVmZml4JyB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICB9fTxhIFtyb3V0ZXJMaW5rXT1cIlsnL215LWFjY291bnQvbm90aWZpY2F0aW9uLXByZWZlcmVuY2UnXVwiPnt7XG4gICAgICAgICAgICAgICdteUNvdXBvbnMubm90ZXNMaW5rJyB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICB9fTwvYVxuICAgICAgICAgICAgPnt7ICdteUNvdXBvbnMubm90ZXNTdWZmaXgnIHwgY3hUcmFuc2xhdGUgfX08L3NwYW5cbiAgICAgICAgICA+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9uZy1jb250YWluZXI+XG5cbiAgICA8bmctdGVtcGxhdGUgI25vQ291cG9ucz5cbiAgICAgIDxzZWN0aW9uPlxuICAgICAgICA8cCBjbGFzcz1cImN4LXNlY3Rpb24tbXNnXCI+XG4gICAgICAgICAge3sgJ215Q291cG9ucy5ub0NvdXBvbnNNZXNzYWdlJyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgIDwvcD5cbiAgICAgIDwvc2VjdGlvbj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICA8L25nLWNvbnRhaW5lcj5cblxuICA8bmctdGVtcGxhdGUgI2xvYWRpbmc+XG4gICAgPGRpdiBjbGFzcz1cImNvbC1tZC0xMiBjeC1jb3Vwb24tc3Bpbm5lclwiPlxuICAgICAgPGN4LXNwaW5uZXI+PC9jeC1zcGlubmVyPlxuICAgIDwvZGl2PlxuICA8L25nLXRlbXBsYXRlPlxuPC9kaXY+XG4iXX0=