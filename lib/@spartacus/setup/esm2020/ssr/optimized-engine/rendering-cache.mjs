/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
export class RenderingCache {
    constructor(options) {
        this.options = options;
        this.renders = new Map();
    }
    setAsRendering(key) {
        this.renders.set(key, { rendering: true });
    }
    isRendering(key) {
        return !!this.renders.get(key)?.rendering;
    }
    store(key, err, html) {
        const entry = { err, html };
        if (this.options?.ttl) {
            entry.time = Date.now();
        }
        if (this.options?.cacheSize) {
            this.renders.delete(key);
            if (this.renders.size >= this.options.cacheSize) {
                this.renders.delete(this.renders.keys().next().value);
            }
        }
        this.renders.set(key, entry);
    }
    get(key) {
        return this.renders.get(key);
    }
    clear(key) {
        this.renders.delete(key);
    }
    isReady(key) {
        const entry = this.renders.get(key);
        const isRenderPresent = entry?.html || entry?.err;
        return isRenderPresent && this.isFresh(key);
    }
    isFresh(key) {
        if (!this.options?.ttl) {
            return true;
        }
        return Date.now() - (this.renders.get(key)?.time ?? 0) < this.options?.ttl;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyaW5nLWNhY2hlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vY29yZS1saWJzL3NldHVwL3Nzci9vcHRpbWl6ZWQtZW5naW5lL3JlbmRlcmluZy1jYWNoZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBV0gsTUFBTSxPQUFPLGNBQWM7SUFHekIsWUFBb0IsT0FBZ0M7UUFBaEMsWUFBTyxHQUFQLE9BQU8sQ0FBeUI7UUFGMUMsWUFBTyxHQUFHLElBQUksR0FBRyxFQUEwQixDQUFDO0lBRUMsQ0FBQztJQUV4RCxjQUFjLENBQUMsR0FBVztRQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsV0FBVyxDQUFDLEdBQVc7UUFDckIsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsU0FBUyxDQUFDO0lBQzVDLENBQUM7SUFFRCxLQUFLLENBQUMsR0FBVyxFQUFFLEdBQWtCLEVBQUUsSUFBYTtRQUNsRCxNQUFNLEtBQUssR0FBbUIsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDNUMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtZQUNyQixLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUN6QjtRQUNELElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUU7WUFDM0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDekIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRTtnQkFDL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN2RDtTQUNGO1FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRCxHQUFHLENBQUMsR0FBVztRQUNiLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFXO1FBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELE9BQU8sQ0FBQyxHQUFXO1FBQ2pCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sZUFBZSxHQUFHLEtBQUssRUFBRSxJQUFJLElBQUksS0FBSyxFQUFFLEdBQUcsQ0FBQztRQUNsRCxPQUFPLGVBQWUsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxPQUFPLENBQUMsR0FBVztRQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7WUFDdEIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDO0lBQzdFLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IFNzck9wdGltaXphdGlvbk9wdGlvbnMgfSBmcm9tICcuL3Nzci1vcHRpbWl6YXRpb24tb3B0aW9ucyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyaW5nRW50cnkge1xuICBodG1sPzogYW55O1xuICBlcnI/OiBhbnk7XG4gIHRpbWU/OiBudW1iZXI7XG4gIHJlbmRlcmluZz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBSZW5kZXJpbmdDYWNoZSB7XG4gIHByb3RlY3RlZCByZW5kZXJzID0gbmV3IE1hcDxzdHJpbmcsIFJlbmRlcmluZ0VudHJ5PigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgb3B0aW9ucz86IFNzck9wdGltaXphdGlvbk9wdGlvbnMpIHt9XG5cbiAgc2V0QXNSZW5kZXJpbmcoa2V5OiBzdHJpbmcpIHtcbiAgICB0aGlzLnJlbmRlcnMuc2V0KGtleSwgeyByZW5kZXJpbmc6IHRydWUgfSk7XG4gIH1cblxuICBpc1JlbmRlcmluZyhrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMucmVuZGVycy5nZXQoa2V5KT8ucmVuZGVyaW5nO1xuICB9XG5cbiAgc3RvcmUoa2V5OiBzdHJpbmcsIGVycj86IEVycm9yIHwgbnVsbCwgaHRtbD86IHN0cmluZykge1xuICAgIGNvbnN0IGVudHJ5OiBSZW5kZXJpbmdFbnRyeSA9IHsgZXJyLCBodG1sIH07XG4gICAgaWYgKHRoaXMub3B0aW9ucz8udHRsKSB7XG4gICAgICBlbnRyeS50aW1lID0gRGF0ZS5ub3coKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9ucz8uY2FjaGVTaXplKSB7XG4gICAgICB0aGlzLnJlbmRlcnMuZGVsZXRlKGtleSk7XG4gICAgICBpZiAodGhpcy5yZW5kZXJzLnNpemUgPj0gdGhpcy5vcHRpb25zLmNhY2hlU2l6ZSkge1xuICAgICAgICB0aGlzLnJlbmRlcnMuZGVsZXRlKHRoaXMucmVuZGVycy5rZXlzKCkubmV4dCgpLnZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5yZW5kZXJzLnNldChrZXksIGVudHJ5KTtcbiAgfVxuXG4gIGdldChrZXk6IHN0cmluZyk6IFJlbmRlcmluZ0VudHJ5IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJzLmdldChrZXkpO1xuICB9XG5cbiAgY2xlYXIoa2V5OiBzdHJpbmcpIHtcbiAgICB0aGlzLnJlbmRlcnMuZGVsZXRlKGtleSk7XG4gIH1cblxuICBpc1JlYWR5KGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZW50cnkgPSB0aGlzLnJlbmRlcnMuZ2V0KGtleSk7XG4gICAgY29uc3QgaXNSZW5kZXJQcmVzZW50ID0gZW50cnk/Lmh0bWwgfHwgZW50cnk/LmVycjtcbiAgICByZXR1cm4gaXNSZW5kZXJQcmVzZW50ICYmIHRoaXMuaXNGcmVzaChrZXkpO1xuICB9XG5cbiAgaXNGcmVzaChrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5vcHRpb25zPy50dGwpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBEYXRlLm5vdygpIC0gKHRoaXMucmVuZGVycy5nZXQoa2V5KT8udGltZSA/PyAwKSA8IHRoaXMub3B0aW9ucz8udHRsO1xuICB9XG59XG4iXX0=