/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { inject } from '@angular/core';
import { INITIAL_CONFIG } from '@angular/platform-server';
import { SERVER_REQUEST_ORIGIN, SERVER_REQUEST_URL } from '@spartacus/core';
/**
 * Returns a factory function which resolves the server request URL.
 */
export function serverRequestUrlFactory(options) {
    return () => {
        const platformConfig = inject(INITIAL_CONFIG);
        const serverRequestOrigin = inject(SERVER_REQUEST_ORIGIN);
        const serverRequestUrl = inject(SERVER_REQUEST_URL, {
            optional: true,
            skipSelf: true,
        });
        // SSR mode
        if (serverRequestUrl) {
            // should override the automatically recognized origin
            if (options?.serverRequestOrigin) {
                return serverRequestUrl.replace(serverRequestOrigin, options.serverRequestOrigin);
            }
            return serverRequestUrl;
        }
        // prerendering mode (no express server)
        return serverRequestOrigin + platformConfig.url;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLXJlcXVlc3QtdXJsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vY29yZS1saWJzL3NldHVwL3Nzci9wcm92aWRlcnMvc2VydmVyLXJlcXVlc3QtdXJsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMxRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUc1RTs7R0FFRztBQUNILE1BQU0sVUFBVSx1QkFBdUIsQ0FBQyxPQUF1QjtJQUM3RCxPQUFPLEdBQVcsRUFBRTtRQUNsQixNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDOUMsTUFBTSxtQkFBbUIsR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUMxRCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTtZQUNsRCxRQUFRLEVBQUUsSUFBSTtZQUNkLFFBQVEsRUFBRSxJQUFJO1NBQ2YsQ0FBQyxDQUFDO1FBRUgsV0FBVztRQUNYLElBQUksZ0JBQWdCLEVBQUU7WUFDcEIsc0RBQXNEO1lBQ3RELElBQUksT0FBTyxFQUFFLG1CQUFtQixFQUFFO2dCQUNoQyxPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FDN0IsbUJBQW1CLEVBQ25CLE9BQU8sQ0FBQyxtQkFBbUIsQ0FDNUIsQ0FBQzthQUNIO1lBRUQsT0FBTyxnQkFBZ0IsQ0FBQztTQUN6QjtRQUVELHdDQUF3QztRQUN4QyxPQUFPLG1CQUFtQixHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUM7SUFDbEQsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IGluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSU5JVElBTF9DT05GSUcgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1zZXJ2ZXInO1xuaW1wb3J0IHsgU0VSVkVSX1JFUVVFU1RfT1JJR0lOLCBTRVJWRVJfUkVRVUVTVF9VUkwgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgU2VydmVyT3B0aW9ucyB9IGZyb20gJy4vbW9kZWwnO1xuXG4vKipcbiAqIFJldHVybnMgYSBmYWN0b3J5IGZ1bmN0aW9uIHdoaWNoIHJlc29sdmVzIHRoZSBzZXJ2ZXIgcmVxdWVzdCBVUkwuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXJ2ZXJSZXF1ZXN0VXJsRmFjdG9yeShvcHRpb25zPzogU2VydmVyT3B0aW9ucyk6IEZ1bmN0aW9uIHtcbiAgcmV0dXJuICgpOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IHBsYXRmb3JtQ29uZmlnID0gaW5qZWN0KElOSVRJQUxfQ09ORklHKTtcbiAgICBjb25zdCBzZXJ2ZXJSZXF1ZXN0T3JpZ2luID0gaW5qZWN0KFNFUlZFUl9SRVFVRVNUX09SSUdJTik7XG4gICAgY29uc3Qgc2VydmVyUmVxdWVzdFVybCA9IGluamVjdChTRVJWRVJfUkVRVUVTVF9VUkwsIHtcbiAgICAgIG9wdGlvbmFsOiB0cnVlLFxuICAgICAgc2tpcFNlbGY6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBTU1IgbW9kZVxuICAgIGlmIChzZXJ2ZXJSZXF1ZXN0VXJsKSB7XG4gICAgICAvLyBzaG91bGQgb3ZlcnJpZGUgdGhlIGF1dG9tYXRpY2FsbHkgcmVjb2duaXplZCBvcmlnaW5cbiAgICAgIGlmIChvcHRpb25zPy5zZXJ2ZXJSZXF1ZXN0T3JpZ2luKSB7XG4gICAgICAgIHJldHVybiBzZXJ2ZXJSZXF1ZXN0VXJsLnJlcGxhY2UoXG4gICAgICAgICAgc2VydmVyUmVxdWVzdE9yaWdpbixcbiAgICAgICAgICBvcHRpb25zLnNlcnZlclJlcXVlc3RPcmlnaW5cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNlcnZlclJlcXVlc3RVcmw7XG4gICAgfVxuXG4gICAgLy8gcHJlcmVuZGVyaW5nIG1vZGUgKG5vIGV4cHJlc3Mgc2VydmVyKVxuICAgIHJldHVybiBzZXJ2ZXJSZXF1ZXN0T3JpZ2luICsgcGxhdGZvcm1Db25maWcudXJsO1xuICB9O1xufVxuIl19