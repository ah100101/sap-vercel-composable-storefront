/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, HostListener, } from '@angular/core';
import { UntypedFormControl, UntypedFormGroup } from '@angular/forms';
import { PromotionLocation, } from '@spartacus/cart/base/root';
import { ICON_TYPE, } from '@spartacus/storefront';
import { Subscription } from 'rxjs';
import { filter, map, shareReplay, startWith, switchMap, switchMapTo, tap, } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/cart/base/root";
import * as i2 from "@spartacus/storefront";
import * as i3 from "@spartacus/core";
import * as i4 from "@angular/common";
import * as i5 from "../cart-shared/cart-item/cart-item.component";
import * as i6 from "@angular/router";
export class AddedToCartDialogComponent {
    handleClick(event) {
        if (event.target.tagName === this.el.nativeElement.tagName) {
            this.dismissModal('Cross click');
        }
    }
    constructor(activeCartFacade, launchDialogService, routingService, el) {
        this.activeCartFacade = activeCartFacade;
        this.launchDialogService = launchDialogService;
        this.routingService = routingService;
        this.el = el;
        this.iconTypes = ICON_TYPE;
        this.cart$ = this.activeCartFacade.getActive();
        this.loaded$ = this.activeCartFacade.isStable();
        this.promotionLocation = PromotionLocation.ActiveCart;
        this.quantity = 0;
        this.form = new UntypedFormGroup({});
        this.focusConfig = {
            trap: true,
            block: true,
            autofocus: 'button',
            focusOnEscape: true,
        };
        this.subscription = new Subscription();
    }
    ngOnInit() {
        this.subscription.add(this.launchDialogService.data$.subscribe((dialogData) => {
            this.init(dialogData.productCode, dialogData.quantity, dialogData.numberOfEntriesBeforeAdd, dialogData.pickupStoreName);
        }));
        this.subscription.add(this.routingService
            .getRouterState()
            .pipe(filter((state) => !!state.nextState))
            .subscribe(() => this.dismissModal('dismiss')));
    }
    /**
     * Returns an observable formControl with the quantity of the cartEntry,
     * but also updates the entry in case of a changed value.
     * The quantity can be set to zero in order to remove the entry.
     */
    getQuantityControl() {
        if (!this.quantityControl$) {
            this.quantityControl$ = this.entry$.pipe(filter((e) => !!e), map((entry) => this.getQuantityFormControl(entry)), switchMap(() => this.form.valueChanges.pipe(
            // eslint-disable-next-line import/no-deprecated
            startWith(null), tap((valueChange) => {
                if (valueChange) {
                    this.activeCartFacade.updateEntry(valueChange.entryNumber, valueChange.quantity);
                    if (valueChange.quantity === 0) {
                        this.dismissModal('Removed');
                    }
                }
                else {
                    this.form.markAsPristine();
                }
            }))), map(() => this.form.get('quantity')), shareReplay({ bufferSize: 1, refCount: true }));
        }
        return this.quantityControl$;
    }
    init(productCode, quantity, numberOfEntriesBeforeAdd, pickupStoreName) {
        // Display last entry for new product code. This always corresponds to
        // our new item, independently of whether merging occured or not
        this.entry$ = this.activeCartFacade.getLastEntry(productCode);
        this.quantity = quantity;
        this.addedEntryWasMerged$ = this.getAddedEntryWasMerged(numberOfEntriesBeforeAdd);
        this.pickupStoreName = pickupStoreName;
    }
    getAddedEntryWasMerged(numberOfEntriesBeforeAdd) {
        return this.loaded$.pipe(filter((loaded) => loaded), switchMapTo(this.activeCartFacade.getEntries()), map((entries) => entries.length === numberOfEntriesBeforeAdd));
    }
    /**
     * Adds quantity and entryNumber form controls to the FormGroup.
     * Returns quantity form control.
     */
    getQuantityFormControl(entry) {
        if (!this.form.get('quantity')) {
            const quantity = new UntypedFormControl(entry?.quantity, {
                updateOn: 'blur',
            });
            this.form.addControl('quantity', quantity);
            const entryNumber = new UntypedFormControl(entry?.entryNumber);
            this.form.addControl('entryNumber', entryNumber);
        }
        else {
            // set the real quantity added to cart
            this.form.get('quantity')?.setValue(entry?.quantity);
        }
        return this.form.get('quantity');
    }
    dismissModal(reason) {
        this.launchDialogService.closeDialog(reason);
    }
    ngOnDestroy() {
        this.subscription?.unsubscribe();
    }
}
AddedToCartDialogComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: AddedToCartDialogComponent, deps: [{ token: i1.ActiveCartFacade }, { token: i2.LaunchDialogService }, { token: i3.RoutingService }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
AddedToCartDialogComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.4", type: AddedToCartDialogComponent, selector: "cx-added-to-cart-dialog", host: { listeners: { "click": "handleClick($event)" } }, ngImport: i0, template: "<div\n  class=\"cx-modal-container\"\n  [cxFocus]=\"focusConfig\"\n  (esc)=\"dismissModal('Escape pressed')\"\n>\n  <div class=\"cx-modal-content\">\n    <!-- Modal Header -->\n    <ng-container *ngIf=\"loaded$ | async; else loading\">\n      <div class=\"cx-dialog-header modal-header\">\n        <div class=\"cx-dialog-title modal-title\">\n          {{\n            (addedEntryWasMerged$ | async)\n              ? ('addToCart.itemsIncrementedInYourCart' | cxTranslate)\n              : ('addToCart.itemsAddedToYourCart' | cxTranslate)\n          }}\n        </div>\n        <button\n          type=\"button\"\n          class=\"close\"\n          attr.aria-label=\"{{ 'addToCart.closeModal' | cxTranslate }}\"\n          (click)=\"dismissModal('Cross click')\"\n        >\n          <span aria-hidden=\"true\">\n            <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n          </span>\n        </button>\n      </div>\n\n      <!-- Modal Body -->\n      <div class=\"cx-dialog-body modal-body\" *ngIf=\"entry$ | async as entry\">\n        <div class=\"cx-dialog-row\">\n          <div class=\"cx-dialog-item col-sm-12 col-md-6\">\n            <cx-cart-item\n              [item]=\"entry\"\n              [compact]=\"true\"\n              [quantityControl]=\"getQuantityControl() | async\"\n              [promotionLocation]=\"promotionLocation\"\n            ></cx-cart-item>\n            <div class=\"cx-dialog-pickup-store\" *ngIf=\"pickupStoreName\">\n              {{ 'pickupOptionDialog.modalHeader' | cxTranslate }}:\n              <span class=\"cx-dialog-pickup-store-name\">{{\n                pickupStoreName\n              }}</span>\n            </div>\n          </div>\n          <!-- Separator -->\n          <div\n            class=\"\n              cx-dialog-separator\n              col-sm-12\n              d-xs-block d-sm-block d-md-none\n            \"\n          ></div>\n          <!-- Total container -->\n          <div\n            class=\"cx-dialog-actions col-sm-12 col-md-6\"\n            *ngIf=\"cart$ | async as cart\"\n          >\n            <div class=\"cx-dialog-total\">\n              <div>\n                {{\n                  'cartItems.cartTotal'\n                    | cxTranslate: { count: cart.deliveryItemsQuantity }\n                }}\n              </div>\n\n              <div>{{ cart.subTotal?.formattedValue }}</div>\n            </div>\n\n            <!-- Promotions -->\n            <div class=\"cx-dialog-promotions\">\n              <cx-promotions\n                [promotions]=\"\n                  (cart.appliedOrderPromotions || []).concat(\n                    cart.potentialOrderPromotions || []\n                  )\n                \"\n              ></cx-promotions>\n            </div>\n\n            <!-- Actions -->\n            <div class=\"cx-dialog-buttons\">\n              <a\n                [class.disabled]=\"form.dirty\"\n                [routerLink]=\"{ cxRoute: 'cart' } | cxUrl\"\n                (click)=\"dismissModal('View Cart click')\"\n                class=\"btn btn-primary\"\n                autofocus\n                >{{ 'addToCart.viewCart' | cxTranslate }}</a\n              >\n              <a\n                [class.disabled]=\"form.dirty\"\n                [routerLink]=\"{ cxRoute: 'checkout' } | cxUrl\"\n                (click)=\"dismissModal('Proceed To Checkout click')\"\n                class=\"btn btn-secondary\"\n                >{{ 'addToCart.proceedToCheckout' | cxTranslate }}</a\n              >\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n\n    <ng-template #loading>\n      <div class=\"cx-dialog-header modal-header\">\n        <div class=\"cx-dialog-title modal-title\">\n          {{ 'addToCart.updatingCart' | cxTranslate }}\n        </div>\n        <button\n          type=\"button\"\n          class=\"close\"\n          [attr.aria-label]=\"'common.close' | cxTranslate\"\n          (click)=\"dismissModal('Cross click')\"\n        >\n          <span aria-hidden=\"true\">\n            <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n          </span>\n        </button>\n      </div>\n      <!-- Modal Body -->\n      <div class=\"cx-dialog-body modal-body\">\n        <div class=\"cx-dialog-row\">\n          <div class=\"col-sm-12\"><cx-spinner></cx-spinner></div>\n        </div>\n      </div>\n    </ng-template>\n\n    <!-- For screen reader purposes (not visual)-->\n    <div class=\"cx-visually-hidden\" aria-live=\"polite\" aria-atomic=\"true\">\n      {{\n        (addedEntryWasMerged$ | async)\n          ? ('addToCart.itemsIncrementedInYourCart' | cxTranslate)\n          : ('addToCart.itemsAddedToYourCart' | cxTranslate)\n      }}\n    </div>\n  </div>\n</div>\n", dependencies: [{ kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i5.CartItemComponent, selector: "cx-cart-item", inputs: ["compact", "item", "readonly", "quantityControl", "promotionLocation", "options"] }, { kind: "directive", type: i6.RouterLink, selector: "[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "component", type: i2.SpinnerComponent, selector: "cx-spinner" }, { kind: "component", type: i2.PromotionsComponent, selector: "cx-promotions", inputs: ["promotions"] }, { kind: "component", type: i2.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "directive", type: i2.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.UrlPipe, name: "cxUrl" }, { kind: "pipe", type: i3.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.4", ngImport: i0, type: AddedToCartDialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-added-to-cart-dialog', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div\n  class=\"cx-modal-container\"\n  [cxFocus]=\"focusConfig\"\n  (esc)=\"dismissModal('Escape pressed')\"\n>\n  <div class=\"cx-modal-content\">\n    <!-- Modal Header -->\n    <ng-container *ngIf=\"loaded$ | async; else loading\">\n      <div class=\"cx-dialog-header modal-header\">\n        <div class=\"cx-dialog-title modal-title\">\n          {{\n            (addedEntryWasMerged$ | async)\n              ? ('addToCart.itemsIncrementedInYourCart' | cxTranslate)\n              : ('addToCart.itemsAddedToYourCart' | cxTranslate)\n          }}\n        </div>\n        <button\n          type=\"button\"\n          class=\"close\"\n          attr.aria-label=\"{{ 'addToCart.closeModal' | cxTranslate }}\"\n          (click)=\"dismissModal('Cross click')\"\n        >\n          <span aria-hidden=\"true\">\n            <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n          </span>\n        </button>\n      </div>\n\n      <!-- Modal Body -->\n      <div class=\"cx-dialog-body modal-body\" *ngIf=\"entry$ | async as entry\">\n        <div class=\"cx-dialog-row\">\n          <div class=\"cx-dialog-item col-sm-12 col-md-6\">\n            <cx-cart-item\n              [item]=\"entry\"\n              [compact]=\"true\"\n              [quantityControl]=\"getQuantityControl() | async\"\n              [promotionLocation]=\"promotionLocation\"\n            ></cx-cart-item>\n            <div class=\"cx-dialog-pickup-store\" *ngIf=\"pickupStoreName\">\n              {{ 'pickupOptionDialog.modalHeader' | cxTranslate }}:\n              <span class=\"cx-dialog-pickup-store-name\">{{\n                pickupStoreName\n              }}</span>\n            </div>\n          </div>\n          <!-- Separator -->\n          <div\n            class=\"\n              cx-dialog-separator\n              col-sm-12\n              d-xs-block d-sm-block d-md-none\n            \"\n          ></div>\n          <!-- Total container -->\n          <div\n            class=\"cx-dialog-actions col-sm-12 col-md-6\"\n            *ngIf=\"cart$ | async as cart\"\n          >\n            <div class=\"cx-dialog-total\">\n              <div>\n                {{\n                  'cartItems.cartTotal'\n                    | cxTranslate: { count: cart.deliveryItemsQuantity }\n                }}\n              </div>\n\n              <div>{{ cart.subTotal?.formattedValue }}</div>\n            </div>\n\n            <!-- Promotions -->\n            <div class=\"cx-dialog-promotions\">\n              <cx-promotions\n                [promotions]=\"\n                  (cart.appliedOrderPromotions || []).concat(\n                    cart.potentialOrderPromotions || []\n                  )\n                \"\n              ></cx-promotions>\n            </div>\n\n            <!-- Actions -->\n            <div class=\"cx-dialog-buttons\">\n              <a\n                [class.disabled]=\"form.dirty\"\n                [routerLink]=\"{ cxRoute: 'cart' } | cxUrl\"\n                (click)=\"dismissModal('View Cart click')\"\n                class=\"btn btn-primary\"\n                autofocus\n                >{{ 'addToCart.viewCart' | cxTranslate }}</a\n              >\n              <a\n                [class.disabled]=\"form.dirty\"\n                [routerLink]=\"{ cxRoute: 'checkout' } | cxUrl\"\n                (click)=\"dismissModal('Proceed To Checkout click')\"\n                class=\"btn btn-secondary\"\n                >{{ 'addToCart.proceedToCheckout' | cxTranslate }}</a\n              >\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n\n    <ng-template #loading>\n      <div class=\"cx-dialog-header modal-header\">\n        <div class=\"cx-dialog-title modal-title\">\n          {{ 'addToCart.updatingCart' | cxTranslate }}\n        </div>\n        <button\n          type=\"button\"\n          class=\"close\"\n          [attr.aria-label]=\"'common.close' | cxTranslate\"\n          (click)=\"dismissModal('Cross click')\"\n        >\n          <span aria-hidden=\"true\">\n            <cx-icon [type]=\"iconTypes.CLOSE\"></cx-icon>\n          </span>\n        </button>\n      </div>\n      <!-- Modal Body -->\n      <div class=\"cx-dialog-body modal-body\">\n        <div class=\"cx-dialog-row\">\n          <div class=\"col-sm-12\"><cx-spinner></cx-spinner></div>\n        </div>\n      </div>\n    </ng-template>\n\n    <!-- For screen reader purposes (not visual)-->\n    <div class=\"cx-visually-hidden\" aria-live=\"polite\" aria-atomic=\"true\">\n      {{\n        (addedEntryWasMerged$ | async)\n          ? ('addToCart.itemsIncrementedInYourCart' | cxTranslate)\n          : ('addToCart.itemsAddedToYourCart' | cxTranslate)\n      }}\n    </div>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ActiveCartFacade }, { type: i2.LaunchDialogService }, { type: i3.RoutingService }, { type: i0.ElementRef }]; }, propDecorators: { handleClick: [{
                type: HostListener,
                args: ['click', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkZWQtdG8tY2FydC1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL2NhcnQvYmFzZS9jb21wb25lbnRzL2FkZGVkLXRvLWNhcnQtZGlhbG9nL2FkZGVkLXRvLWNhcnQtZGlhbG9nLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9jYXJ0L2Jhc2UvY29tcG9uZW50cy9hZGRlZC10by1jYXJ0LWRpYWxvZy9hZGRlZC10by1jYXJ0LWRpYWxvZy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBRVQsWUFBWSxHQUdiLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RFLE9BQU8sRUFLTCxpQkFBaUIsR0FDbEIsTUFBTSwyQkFBMkIsQ0FBQztBQUVuQyxPQUFPLEVBRUwsU0FBUyxHQUVWLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxFQUFjLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRCxPQUFPLEVBQ0wsTUFBTSxFQUNOLEdBQUcsRUFDSCxXQUFXLEVBQ1gsU0FBUyxFQUNULFNBQVMsRUFDVCxXQUFXLEVBQ1gsR0FBRyxHQUNKLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7O0FBT3hCLE1BQU0sT0FBTywwQkFBMEI7SUFzQnJDLFdBQVcsQ0FBQyxLQUFjO1FBQ3hCLElBQUssS0FBSyxDQUFDLE1BQWMsQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFO1lBQ25FLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDbEM7SUFDSCxDQUFDO0lBTUQsWUFDWSxnQkFBa0Ms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LENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFM0MsTUFBTSxXQUFXLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1NBQ2xEO2FBQU07WUFDTCxzQ0FBc0M7WUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztTQUN0RDtRQUVELE9BQTJCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRCxZQUFZLENBQUMsTUFBWTtRQUN2QixJQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFlBQVksRUFBRSxXQUFXLEVBQUUsQ0FBQztJQUNuQyxDQUFDOzt1SEFySlUsMEJBQTBCOzJHQUExQiwwQkFBMEIsd0hDNUN2Qyw2b0pBeUlBOzJGRDdGYSwwQkFBMEI7a0JBTHRDLFNBQVM7K0JBQ0UseUJBQXlCLG1CQUVsQix1QkFBdUIsQ0FBQyxNQUFNOytMQXdCL0MsV0FBVztzQkFEVixZQUFZO3VCQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIzIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVW50eXBlZEZvcm1Db250cm9sLCBVbnR5cGVkRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtcbiAgQWN0aXZlQ2FydEZhY2FkZSxcbiAgQ2FydCxcbiAgQ2FydFVpRXZlbnRBZGRUb0NhcnQsXG4gIE9yZGVyRW50cnksXG4gIFByb21vdGlvbkxvY2F0aW9uLFxufSBmcm9tICdAc3BhcnRhY3VzL2NhcnQvYmFzZS9yb290JztcbmltcG9ydCB7IFJvdXRpbmdTZXJ2aWNlIH0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7XG4gIEZvY3VzQ29uZmlnLFxuICBJQ09OX1RZUEUsXG4gIExhdW5jaERpYWxvZ1NlcnZpY2UsXG59IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmcm9udCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGZpbHRlcixcbiAgbWFwLFxuICBzaGFyZVJlcGxheSxcbiAgc3RhcnRXaXRoLFxuICBzd2l0Y2hNYXAsXG4gIHN3aXRjaE1hcFRvLFxuICB0YXAsXG59IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtYWRkZWQtdG8tY2FydC1kaWFsb2cnLFxuICB0ZW1wbGF0ZVVybDogJy4vYWRkZWQtdG8tY2FydC1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgQWRkZWRUb0NhcnREaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIGljb25UeXBlcyA9IElDT05fVFlQRTtcblxuICBlbnRyeSQ6IE9ic2VydmFibGU8T3JkZXJFbnRyeSB8IHVuZGVmaW5lZD47XG4gIGNhcnQkOiBPYnNlcnZhYmxlPENhcnQ+ID0gdGhpcy5hY3RpdmVDYXJ0RmFjYWRlLmdldEFjdGl2ZSgpO1xuICBsb2FkZWQkOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gdGhpcy5hY3RpdmVDYXJ0RmFjYWRlLmlzU3RhYmxlKCk7XG4gIGFkZGVkRW50cnlXYXNNZXJnZWQkOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBwcm9tb3Rpb25Mb2NhdGlvbjogUHJvbW90aW9uTG9jYXRpb24gPSBQcm9tb3Rpb25Mb2NhdGlvbi5BY3RpdmVDYXJ0O1xuXG4gIHF1YW50aXR5ID0gMDtcbiAgcGlja3VwU3RvcmVOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgZm9ybTogVW50eXBlZEZvcm1Hcm91cCA9IG5ldyBVbnR5cGVkRm9ybUdyb3VwKHt9KTtcblxuICBmb2N1c0NvbmZpZzogRm9jdXNDb25maWcgPSB7XG4gICAgdHJhcDogdHJ1ZSxcbiAgICBibG9jazogdHJ1ZSxcbiAgICBhdXRvZm9jdXM6ICdidXR0b24nLFxuICAgIGZvY3VzT25Fc2NhcGU6IHRydWUsXG4gIH07XG5cbiAgQEhvc3RMaXN0ZW5lcignY2xpY2snLCBbJyRldmVudCddKVxuICBoYW5kbGVDbGljayhldmVudDogVUlFdmVudCk6IHZvaWQge1xuICAgIGlmICgoZXZlbnQudGFyZ2V0IGFzIGFueSkudGFnTmFtZSA9PT0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnRhZ05hbWUpIHtcbiAgICAgIHRoaXMuZGlzbWlzc01vZGFsKCdDcm9zcyBjbGljaycpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBxdWFudGl0eUNvbnRyb2wkOiBPYnNlcnZhYmxlPFVudHlwZWRGb3JtQ29udHJvbD47XG5cbiAgcHJvdGVjdGVkIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgYWN0aXZlQ2FydEZhY2FkZTogQWN0aXZlQ2FydEZhY2FkZSxcbiAgICBwcm90ZWN0ZWQgbGF1bmNoRGlhbG9nU2VydmljZTogTGF1bmNoRGlhbG9nU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgcm91dGluZ1NlcnZpY2U6IFJvdXRpbmdTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBlbDogRWxlbWVudFJlZlxuICApIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgdGhpcy5sYXVuY2hEaWFsb2dTZXJ2aWNlLmRhdGEkLnN1YnNjcmliZShcbiAgICAgICAgKGRpYWxvZ0RhdGE6IENhcnRVaUV2ZW50QWRkVG9DYXJ0KSA9PiB7XG4gICAgICAgICAgdGhpcy5pbml0KFxuICAgICAgICAgICAgZGlhbG9nRGF0YS5wcm9kdWN0Q29kZSxcbiAgICAgICAgICAgIGRpYWxvZ0RhdGEucXVhbnRpdHksXG4gICAgICAgICAgICBkaWFsb2dEYXRhLm51bWJlck9mRW50cmllc0JlZm9yZUFkZCxcbiAgICAgICAgICAgIGRpYWxvZ0RhdGEucGlja3VwU3RvcmVOYW1lXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgdGhpcy5yb3V0aW5nU2VydmljZVxuICAgICAgICAuZ2V0Um91dGVyU3RhdGUoKVxuICAgICAgICAucGlwZShmaWx0ZXIoKHN0YXRlKSA9PiAhIXN0YXRlLm5leHRTdGF0ZSkpXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5kaXNtaXNzTW9kYWwoJ2Rpc21pc3MnKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBmb3JtQ29udHJvbCB3aXRoIHRoZSBxdWFudGl0eSBvZiB0aGUgY2FydEVudHJ5LFxuICAgKiBidXQgYWxzbyB1cGRhdGVzIHRoZSBlbnRyeSBpbiBjYXNlIG9mIGEgY2hhbmdlZCB2YWx1ZS5cbiAgICogVGhlIHF1YW50aXR5IGNhbiBiZSBzZXQgdG8gemVybyBpbiBvcmRlciB0byByZW1vdmUgdGhlIGVudHJ5LlxuICAgKi9cbiAgZ2V0UXVhbnRpdHlDb250cm9sKCk6IE9ic2VydmFibGU8VW50eXBlZEZvcm1Db250cm9sPiB7XG4gICAgaWYgKCF0aGlzLnF1YW50aXR5Q29udHJvbCQpIHtcbiAgICAgIHRoaXMucXVhbnRpdHlDb250cm9sJCA9IHRoaXMuZW50cnkkLnBpcGUoXG4gICAgICAgIGZpbHRlcigoZSkgPT4gISFlKSxcbiAgICAgICAgbWFwKChlbnRyeSkgPT4gdGhpcy5nZXRRdWFudGl0eUZvcm1Db250cm9sKGVudHJ5KSksXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PlxuICAgICAgICAgIHRoaXMuZm9ybS52YWx1ZUNoYW5nZXMucGlwZShcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tZGVwcmVjYXRlZFxuICAgICAgICAgICAgc3RhcnRXaXRoKG51bGwpLFxuICAgICAgICAgICAgdGFwKCh2YWx1ZUNoYW5nZSkgPT4ge1xuICAgICAgICAgICAgICBpZiAodmFsdWVDaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNhcnRGYWNhZGUudXBkYXRlRW50cnkoXG4gICAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZS5lbnRyeU51bWJlcixcbiAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlLnF1YW50aXR5XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVDaGFuZ2UucXVhbnRpdHkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzbWlzc01vZGFsKCdSZW1vdmVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5tYXJrQXNQcmlzdGluZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgbWFwKCgpID0+IDxVbnR5cGVkRm9ybUNvbnRyb2w+dGhpcy5mb3JtLmdldCgncXVhbnRpdHknKSksXG4gICAgICAgIHNoYXJlUmVwbGF5KHsgYnVmZmVyU2l6ZTogMSwgcmVmQ291bnQ6IHRydWUgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnF1YW50aXR5Q29udHJvbCQ7XG4gIH1cblxuICBpbml0KFxuICAgIHByb2R1Y3RDb2RlOiBzdHJpbmcsXG4gICAgcXVhbnRpdHk6IG51bWJlcixcbiAgICBudW1iZXJPZkVudHJpZXNCZWZvcmVBZGQ6IG51bWJlcixcbiAgICBwaWNrdXBTdG9yZU5hbWU/OiBzdHJpbmdcbiAgKTogdm9pZCB7XG4gICAgLy8gRGlzcGxheSBsYXN0IGVudHJ5IGZvciBuZXcgcHJvZHVjdCBjb2RlLiBUaGlzIGFsd2F5cyBjb3JyZXNwb25kcyB0b1xuICAgIC8vIG91ciBuZXcgaXRlbSwgaW5kZXBlbmRlbnRseSBvZiB3aGV0aGVyIG1lcmdpbmcgb2NjdXJlZCBvciBub3RcbiAgICB0aGlzLmVudHJ5JCA9IHRoaXMuYWN0aXZlQ2FydEZhY2FkZS5nZXRMYXN0RW50cnkocHJvZHVjdENvZGUpO1xuICAgIHRoaXMucXVhbnRpdHkgPSBxdWFudGl0eTtcbiAgICB0aGlzLmFkZGVkRW50cnlXYXNNZXJnZWQkID0gdGhpcy5nZXRBZGRlZEVudHJ5V2FzTWVyZ2VkKFxuICAgICAgbnVtYmVyT2ZFbnRyaWVzQmVmb3JlQWRkXG4gICAgKTtcbiAgICB0aGlzLnBpY2t1cFN0b3JlTmFtZSA9IHBpY2t1cFN0b3JlTmFtZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBZGRlZEVudHJ5V2FzTWVyZ2VkKFxuICAgIG51bWJlck9mRW50cmllc0JlZm9yZUFkZDogbnVtYmVyXG4gICk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmxvYWRlZCQucGlwZShcbiAgICAgIGZpbHRlcigobG9hZGVkKSA9PiBsb2FkZWQpLFxuICAgICAgc3dpdGNoTWFwVG8odGhpcy5hY3RpdmVDYXJ0RmFjYWRlLmdldEVudHJpZXMoKSksXG4gICAgICBtYXAoKGVudHJpZXMpID0+IGVudHJpZXMubGVuZ3RoID09PSBudW1iZXJPZkVudHJpZXNCZWZvcmVBZGQpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHF1YW50aXR5IGFuZCBlbnRyeU51bWJlciBmb3JtIGNvbnRyb2xzIHRvIHRoZSBGb3JtR3JvdXAuXG4gICAqIFJldHVybnMgcXVhbnRpdHkgZm9ybSBjb250cm9sLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldFF1YW50aXR5Rm9ybUNvbnRyb2woZW50cnk/OiBPcmRlckVudHJ5KTogVW50eXBlZEZvcm1Db250cm9sIHtcbiAgICBpZiAoIXRoaXMuZm9ybS5nZXQoJ3F1YW50aXR5JykpIHtcbiAgICAgIGNvbnN0IHF1YW50aXR5ID0gbmV3IFVudHlwZWRGb3JtQ29udHJvbChlbnRyeT8ucXVhbnRpdHksIHtcbiAgICAgICAgdXBkYXRlT246ICdibHVyJyxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5mb3JtLmFkZENvbnRyb2woJ3F1YW50aXR5JywgcXVhbnRpdHkpO1xuXG4gICAgICBjb25zdCBlbnRyeU51bWJlciA9IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2woZW50cnk/LmVudHJ5TnVtYmVyKTtcbiAgICAgIHRoaXMuZm9ybS5hZGRDb250cm9sKCdlbnRyeU51bWJlcicsIGVudHJ5TnVtYmVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gc2V0IHRoZSByZWFsIHF1YW50aXR5IGFkZGVkIHRvIGNhcnRcbiAgICAgIHRoaXMuZm9ybS5nZXQoJ3F1YW50aXR5Jyk/LnNldFZhbHVlKGVudHJ5Py5xdWFudGl0eSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIDxVbnR5cGVkRm9ybUNvbnRyb2w+dGhpcy5mb3JtLmdldCgncXVhbnRpdHknKTtcbiAgfVxuXG4gIGRpc21pc3NNb2RhbChyZWFzb24/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxhdW5jaERpYWxvZ1NlcnZpY2UuY2xvc2VEaWFsb2cocmVhc29uKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uPy51bnN1YnNjcmliZSgpO1xuICB9XG59XG4iLCI8ZGl2XG4gIGNsYXNzPVwiY3gtbW9kYWwtY29udGFpbmVyXCJcbiAgW2N4Rm9jdXNdPVwiZm9jdXNDb25maWdcIlxuICAoZXNjKT1cImRpc21pc3NNb2RhbCgnRXNjYXBlIHByZXNzZWQnKVwiXG4+XG4gIDxkaXYgY2xhc3M9XCJjeC1tb2RhbC1jb250ZW50XCI+XG4gICAgPCEtLSBNb2RhbCBIZWFkZXIgLS0+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImxvYWRlZCQgfCBhc3luYzsgZWxzZSBsb2FkaW5nXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY3gtZGlhbG9nLWhlYWRlciBtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LWRpYWxvZy10aXRsZSBtb2RhbC10aXRsZVwiPlxuICAgICAgICAgIHt7XG4gICAgICAgICAgICAoYWRkZWRFbnRyeVdhc01lcmdlZCQgfCBhc3luYylcbiAgICAgICAgICAgICAgPyAoJ2FkZFRvQ2FydC5pdGVtc0luY3JlbWVudGVkSW5Zb3VyQ2FydCcgfCBjeFRyYW5zbGF0ZSlcbiAgICAgICAgICAgICAgOiAoJ2FkZFRvQ2FydC5pdGVtc0FkZGVkVG9Zb3VyQ2FydCcgfCBjeFRyYW5zbGF0ZSlcbiAgICAgICAgICB9fVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgIGNsYXNzPVwiY2xvc2VcIlxuICAgICAgICAgIGF0dHIuYXJpYS1sYWJlbD1cInt7ICdhZGRUb0NhcnQuY2xvc2VNb2RhbCcgfCBjeFRyYW5zbGF0ZSB9fVwiXG4gICAgICAgICAgKGNsaWNrKT1cImRpc21pc3NNb2RhbCgnQ3Jvc3MgY2xpY2snKVwiXG4gICAgICAgID5cbiAgICAgICAgICA8c3BhbiBhcmlhLWhpZGRlbj1cInRydWVcIj5cbiAgICAgICAgICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlcy5DTE9TRVwiPjwvY3gtaWNvbj5cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDwhLS0gTW9kYWwgQm9keSAtLT5cbiAgICAgIDxkaXYgY2xhc3M9XCJjeC1kaWFsb2ctYm9keSBtb2RhbC1ib2R5XCIgKm5nSWY9XCJlbnRyeSQgfCBhc3luYyBhcyBlbnRyeVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY3gtZGlhbG9nLXJvd1wiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1kaWFsb2ctaXRlbSBjb2wtc20tMTIgY29sLW1kLTZcIj5cbiAgICAgICAgICAgIDxjeC1jYXJ0LWl0ZW1cbiAgICAgICAgICAgICAgW2l0ZW1dPVwiZW50cnlcIlxuICAgICAgICAgICAgICBbY29tcGFjdF09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgW3F1YW50aXR5Q29udHJvbF09XCJnZXRRdWFudGl0eUNvbnRyb2woKSB8IGFzeW5jXCJcbiAgICAgICAgICAgICAgW3Byb21vdGlvbkxvY2F0aW9uXT1cInByb21vdGlvbkxvY2F0aW9uXCJcbiAgICAgICAgICAgID48L2N4LWNhcnQtaXRlbT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1kaWFsb2ctcGlja3VwLXN0b3JlXCIgKm5nSWY9XCJwaWNrdXBTdG9yZU5hbWVcIj5cbiAgICAgICAgICAgICAge3sgJ3BpY2t1cE9wdGlvbkRpYWxvZy5tb2RhbEhlYWRlcicgfCBjeFRyYW5zbGF0ZSB9fTpcbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJjeC1kaWFsb2ctcGlja3VwLXN0b3JlLW5hbWVcIj57e1xuICAgICAgICAgICAgICAgIHBpY2t1cFN0b3JlTmFtZVxuICAgICAgICAgICAgICB9fTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwhLS0gU2VwYXJhdG9yIC0tPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGNsYXNzPVwiXG4gICAgICAgICAgICAgIGN4LWRpYWxvZy1zZXBhcmF0b3JcbiAgICAgICAgICAgICAgY29sLXNtLTEyXG4gICAgICAgICAgICAgIGQteHMtYmxvY2sgZC1zbS1ibG9jayBkLW1kLW5vbmVcbiAgICAgICAgICAgIFwiXG4gICAgICAgICAgPjwvZGl2PlxuICAgICAgICAgIDwhLS0gVG90YWwgY29udGFpbmVyIC0tPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGNsYXNzPVwiY3gtZGlhbG9nLWFjdGlvbnMgY29sLXNtLTEyIGNvbC1tZC02XCJcbiAgICAgICAgICAgICpuZ0lmPVwiY2FydCQgfCBhc3luYyBhcyBjYXJ0XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3gtZGlhbG9nLXRvdGFsXCI+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAge3tcbiAgICAgICAgICAgICAgICAgICdjYXJ0SXRlbXMuY2FydFRvdGFsJ1xuICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlOiB7IGNvdW50OiBjYXJ0LmRlbGl2ZXJ5SXRlbXNRdWFudGl0eSB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgPGRpdj57eyBjYXJ0LnN1YlRvdGFsPy5mb3JtYXR0ZWRWYWx1ZSB9fTwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDwhLS0gUHJvbW90aW9ucyAtLT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjeC1kaWFsb2ctcHJvbW90aW9uc1wiPlxuICAgICAgICAgICAgICA8Y3gtcHJvbW90aW9uc1xuICAgICAgICAgICAgICAgIFtwcm9tb3Rpb25zXT1cIlxuICAgICAgICAgICAgICAgICAgKGNhcnQuYXBwbGllZE9yZGVyUHJvbW90aW9ucyB8fCBbXSkuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICBjYXJ0LnBvdGVudGlhbE9yZGVyUHJvbW90aW9ucyB8fCBbXVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgID48L2N4LXByb21vdGlvbnM+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPCEtLSBBY3Rpb25zIC0tPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWRpYWxvZy1idXR0b25zXCI+XG4gICAgICAgICAgICAgIDxhXG4gICAgICAgICAgICAgICAgW2NsYXNzLmRpc2FibGVkXT1cImZvcm0uZGlydHlcIlxuICAgICAgICAgICAgICAgIFtyb3V0ZXJMaW5rXT1cInsgY3hSb3V0ZTogJ2NhcnQnIH0gfCBjeFVybFwiXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cImRpc21pc3NNb2RhbCgnVmlldyBDYXJ0IGNsaWNrJylcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCJcbiAgICAgICAgICAgICAgICBhdXRvZm9jdXNcbiAgICAgICAgICAgICAgICA+e3sgJ2FkZFRvQ2FydC52aWV3Q2FydCcgfCBjeFRyYW5zbGF0ZSB9fTwvYVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxhXG4gICAgICAgICAgICAgICAgW2NsYXNzLmRpc2FibGVkXT1cImZvcm0uZGlydHlcIlxuICAgICAgICAgICAgICAgIFtyb3V0ZXJMaW5rXT1cInsgY3hSb3V0ZTogJ2NoZWNrb3V0JyB9IHwgY3hVcmxcIlxuICAgICAgICAgICAgICAgIChjbGljayk9XCJkaXNtaXNzTW9kYWwoJ1Byb2NlZWQgVG8gQ2hlY2tvdXQgY2xpY2snKVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJidG4gYnRuLXNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgPnt7ICdhZGRUb0NhcnQucHJvY2VlZFRvQ2hlY2tvdXQnIHwgY3hUcmFuc2xhdGUgfX08L2FcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG5cbiAgICA8bmctdGVtcGxhdGUgI2xvYWRpbmc+XG4gICAgICA8ZGl2IGNsYXNzPVwiY3gtZGlhbG9nLWhlYWRlciBtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LWRpYWxvZy10aXRsZSBtb2RhbC10aXRsZVwiPlxuICAgICAgICAgIHt7ICdhZGRUb0NhcnQudXBkYXRpbmdDYXJ0JyB8IGN4VHJhbnNsYXRlIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgY2xhc3M9XCJjbG9zZVwiXG4gICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCInY29tbW9uLmNsb3NlJyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgICAgICAoY2xpY2spPVwiZGlzbWlzc01vZGFsKCdDcm9zcyBjbGljaycpXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPlxuICAgICAgICAgICAgPGN4LWljb24gW3R5cGVdPVwiaWNvblR5cGVzLkNMT1NFXCI+PC9jeC1pY29uPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICAgIDwhLS0gTW9kYWwgQm9keSAtLT5cbiAgICAgIDxkaXYgY2xhc3M9XCJjeC1kaWFsb2ctYm9keSBtb2RhbC1ib2R5XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC1kaWFsb2ctcm93XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMlwiPjxjeC1zcGlubmVyPjwvY3gtc3Bpbm5lcj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLXRlbXBsYXRlPlxuXG4gICAgPCEtLSBGb3Igc2NyZWVuIHJlYWRlciBwdXJwb3NlcyAobm90IHZpc3VhbCktLT5cbiAgICA8ZGl2IGNsYXNzPVwiY3gtdmlzdWFsbHktaGlkZGVuXCIgYXJpYS1saXZlPVwicG9saXRlXCIgYXJpYS1hdG9taWM9XCJ0cnVlXCI+XG4gICAgICB7e1xuICAgICAgICAoYWRkZWRFbnRyeVdhc01lcmdlZCQgfCBhc3luYylcbiAgICAgICAgICA/ICgnYWRkVG9DYXJ0Lml0ZW1zSW5jcmVtZW50ZWRJbllvdXJDYXJ0JyB8IGN4VHJhbnNsYXRlKVxuICAgICAgICAgIDogKCdhZGRUb0NhcnQuaXRlbXNBZGRlZFRvWW91ckNhcnQnIHwgY3hUcmFuc2xhdGUpXG4gICAgICB9fVxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuIl19